<!DOCTYPE html>
<html>
  <head>
    <title>Comic Viewer</title>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/latest/slick.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/solid.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/fontawesome.css"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Comix">
    <link rel="apple-touch-icon" href="/custom_icon.png">
    <link rel="apple-touch-icon" href="touch-icon-iphone.png">
    <link rel="apple-touch-icon" sizes="152x152" href="touch-icon-ipad.png">
    <link rel="apple-touch-icon" sizes="180x180" href="touch-icon-iphone-retina.png">
    <link rel="apple-touch-icon" sizes="167x167" href="touch-icon-ipad-retina.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      html, body { margin: 0; padding: 0; background: black; user-select: none; }
      body * { user-select: none;}
      .img-wrapper { height: 100vh; width: 100vw!important; user-select: none; display: flex!important; justify-content: center; align-items: center; }
      .img-wrapper img { width: auto; height: auto; max-height: 100%; max-width: 100%; margin: 0 auto; user-select: none; }
      .nav { position: absolute; width: 100%; bottom: 0; text-align: center; }
      .nav-item { background: #424242; color: white; padding: 5px 10px; display: inline-block; font-family: Arial; text-decoration: none;}
      .slick-arrow { position: absolute; top: 0; bottom: 0; width: 10%; z-index: 100; }
      .slick-prev { left: 0; }
      .slick-next { right: 0; }
      .slick-track .img-wrapper:last-child { background: white; }
      .catalog { position: absolute; top: 0; width: 100%; height: 50px; margin: 0; padding: 0; }
      .issue-browser { position: absolute; bottom: 0; width: 100%; text-align: center; margin: 0; padding: 0; }
      .issue { display: inline-block; width: 49%; height: 50px; margin: 0; padding: 0;}
      .fa { color: white; }
      .loader { display: flex; align-items: center; justify-content: center; position: absolute; top: 0; bottom: 0; width: 100%; }
/*
      .slick-dots { position: absolute; bottom: 0; width: 100%; text-align: center; margin: 0; padding: 0;}
      .slick-dots li { display: inline-block; margin: 0; padding: 0; }
      .slick-dots li { position: relative; display: inline-block; width: 20px; height: 20px; margin: 0 5px; padding: 0; cursor: pointer; }
      .slick-dots li button { font-size: 0; line-height: 0; display: block; width: 20px; height: 20px; padding: 5px; cursor: pointer; color: transparent; border: 0; outline: none; background: transparent; }
      .slick-dots li button::before { font-size: 6px; line-height: 20px; position: absolute; width: 10px; height: 10px; border-radius: 256px; background: rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.5); top: 0; left: 0; content: ''; text-align: center; }
*/
    </style>
  </head>
  <body>
    <div class="loader">
      <i class="fa fa-circle-notch fa-5x fa-spin"></i>
    </div>
    <div class="slick-wrapper"></div>
    <a href="index.html" class="catalog"></a>
    <div class="issue-browser">
      <a class="issue prev"></a>
      <a class="issue next"></a>
    </div>
  </body>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/latest/slick.min.js"></script>
  <script type="text/javascript">
  $(function() {
    var getUrlParameter = function getUrlParameter(sParam) {
      var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
      for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] === sParam) {
          return sParameterName[1] === undefined ? true : sParameterName[1];
        }
      }
    };
    var step;
    var name = getUrlParameter('name');
    var name = name.toLowerCase();
    console.log(name);
    var vol = getUrlParameter('vol');
    console.log(vol);
    if (vol == undefined) {
      var vol = prompt('Issue Number:', '1');
    }
    step = 1;
    while (step < 60) {
      imgsrc = 'https://readcomics.io/images/manga/'+name+'/'+vol+'/'+step+'.jpg';
      $(".slick-wrapper").append('<div class="img-wrapper"><img src="'+imgsrc+'"/></div>');
      $(".img-wrapper img").on('error', function() {
        $(this).parent().remove();
      });
      step++;
    }
    var prevVol = parseInt(vol)-1;
    var prevLink = location.protocol + '\/\/' + location.host + location.pathname +'?name='+ name+'&vol='+prevVol;
    var nextVol = parseInt(vol)+1;
    var nextLink = location.protocol + '\/\/' + location.host + location.pathname +'?name='+ name+'&vol='+nextVol;
    setTimeout(function(){
      //$('.slick-track .img-wrapper').first().attr('href', prevLink);
      //$('.slick-track .img-wrapper').last().attr('href', nextLink);
      $('.slick-wrapper').slick({
        infinite: false
        ,lazyLoad: true
        ,prevArrow: '<div class="slick-prev slick-arrow"></div>'
        ,nextArrow: '<div class="slick-next slick-arrow"></div>'
        ,speed: 100
        //arrows: false
      });
      $('.issue.prev').attr('href', prevLink);
      $('.issue.next').attr('href', nextLink);
    }, 1000);
    $("a").click(function (event) {
      event.preventDefault();
      window.location = $(this).attr("href");
    });
  });
  </script>
</html>
